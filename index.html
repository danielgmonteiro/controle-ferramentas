<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Ferramentas</title>
  <style>
    :root {
      --primary-color: #4285f4;
      --danger-color: #ea4335;
      --success-color: #34a853;
      --warning-color: #fbbc05;
      --bg-color: #ffffff;
      --text-color: #202124;
      --card-bg: #f8f9fa;
      --border-color: #dadce0;
    }

    .dark-mode {
      --primary-color: #8ab4f8;
      --danger-color: #f28b82;
      --success-color: #81c995;
      --warning-color: #fde293;
      --bg-color: #202124;
      --text-color: #e8eaed;
      --card-bg: #292a2d;
      --border-color: #3c4043;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }

    .header-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }

    .config-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    h1 {
      text-align: center;
      margin: 20px 0;
      color: var(--primary-color);
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    nav button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      min-width: 120px;
    }

    nav button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    #conteudo {
      background-color: var(--card-bg);
      padding: 25px;
      border-radius: 10px;
      min-height: 400px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    button {
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    .action-button {
      background-color: var(--primary-color);
      color: white;
      margin-right: 8px;
    }

    .delete-button {
      background-color: var(--danger-color);
      color: white;
    }

    .sync-button {
      background-color: var(--success-color);
      color: white;
    }

    .config-button {
      background-color: var(--warning-color);
      color: black;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    th, td {
      padding: 12px 15px;
      border: 1px solid var(--border-color);
      text-align: left;
    }

    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
    }

    tr:nth-child(even) {
      background-color: rgba(0, 0, 0, 0.03);
    }

    tr:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    input, select, textarea {
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      width: 100%;
      margin-bottom: 15px;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      flex: 1;
    }

    .github-config {
      margin-top: 20px;
      padding: 20px;
      background-color: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .github-config input {
      margin-bottom: 10px;
    }

    .sync-status {
      padding: 12px 15px;
      border-radius: 6px;
      margin-top: 15px;
      display: none;
    }

    .sync-status.success {
      background-color: var(--success-color);
      color: white;
      display: block;
    }

    .sync-status.error {
      background-color: var(--danger-color);
      color: white;
      display: block;
    }

    .sync-status.warning {
      background-color: var(--warning-color);
      color: black;
      display: block;
    }

    .sync-status.info {
      background-color: var(--primary-color);
      color: white;
      display: block;
    }

    .report-section {
      margin-bottom: 30px;
      padding: 20px;
      background-color: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .report-section h3 {
      margin-top: 0;
      color: var(--primary-color);
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
    }

    .multi-select {
      height: auto;
      min-height: 100px;
      padding: 0;
    }

    .multi-select option {
      padding: 8px 12px;
    }

    .multi-select option:hover {
      background-color: var(--primary-color);
      color: white;
    }

    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 15px;
      }
      
      nav {
        flex-direction: column;
      }
      
      nav button {
        width: 100%;
      }
      
      .header-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .config-buttons {
        width: 100%;
      }
      
      .config-buttons button {
        flex: 1;
        min-width: auto;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      #conteudo {
        padding: 15px;
      }
      
      th, td {
        padding: 8px 10px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-controls">
      <div class="config-buttons">
        <button class="theme-toggle" onclick="toggleTheme()">üåì Tema</button>
        <button class="language-toggle" onclick="toggleLanguage()">üåê Idioma</button>
        <button class="sync-button" onclick="syncData()">üîÑ Sincronizar</button>
        <button class="sync-button" onclick="loadFromGitHub()">‚¨áÔ∏è Carregar Dados</button>
      </div>
      <div class="github-config">
        <input type="password" id="githubToken" placeholder="Token do GitHub">
        <input type="text" id="repoName" placeholder="usuario/repositorio">
        <button class="config-button" onclick="saveGithubConfig()">Salvar Configura√ß√£o</button>
      </div>
    </div>
    
    <h1 id="main-title">Sistema de Controle de Ferramentas</h1>
    
    <nav>
      <button onclick="mostrarSecao('funcionarios')" id="btn-funcionarios">Funcion√°rios</button>
      <button onclick="mostrarSecao('ferramentas')" id="btn-ferramentas">Ferramentas</button>
      <button onclick="mostrarSecao('emprestimos')" id="btn-emprestimos">Empr√©stimos</button>
      <button onclick="mostrarSecao('devolucoes')" id="btn-devolucoes">Devolu√ß√µes</button>
      <button onclick="mostrarSecao('relatorios')" id="btn-relatorios">Relat√≥rios</button>
    </nav>
    
    <div id="conteudo" class="content-box"></div>
    
    <div class="sync-status" id="syncStatus"></div>
  </div>

  <script>
    // Dados do sistema
    let funcionarios = [];
    let ferramentas = [];
    let emprestimos = [];
    let contadorFerramentas = {};
    let darkMode = false;
    let portuguese = true;
    let githubToken = '';
    let repoName = '';

    // Elementos DOM
    const conteudoEl = document.getElementById('conteudo');
    const githubTokenEl = document.getElementById('githubToken');
    const repoNameEl = document.getElementById('repoName');
    const syncStatusEl = document.getElementById('syncStatus');

    // Tradu√ß√µes
    const translations = {
      pt: {
        title: "Sistema de Controle de Ferramentas",
        theme: "üåì Tema",
        language: "üåê Idioma",
        sections: {
          funcionarios: "Funcion√°rios",
          ferramentas: "Ferramentas",
          emprestimos: "Empr√©stimos",
          devolucoes: "Devolu√ß√µes",
          relatorios: "Relat√≥rios"
        },
        funcionarios: {
          title: "Cadastro de Funcion√°rios",
          placeholder: "Nome do funcion√°rio",
          save: "Salvar",
          actions: "A√ß√µes",
          edit: "Editar",
          delete: "Excluir",
          noData: "Nenhum funcion√°rio cadastrado"
        },
        ferramentas: {
          title: "Cadastro de Ferramentas",
          namePlaceholder: "Nome da ferramenta",
          obsPlaceholder: "Observa√ß√µes",
          qtdPlaceholder: "Quantidade",
          save: "Salvar",
          number: "N√∫mero",
          observations: "Observa√ß√µes",
          actions: "A√ß√µes",
          edit: "Editar",
          delete: "Excluir",
          noData: "Nenhuma ferramenta cadastrada"
        },
        emprestimos: {
          title: "Registrar Empr√©stimo",
          user: "Usu√°rio",
          searchUser: "Buscar usu√°rio...",
          tools: "Ferramentas",
          date: "Data",
          save: "Salvar",
          noData: "Nenhum empr√©stimo registrado",
          availableTools: "Ferramentas dispon√≠veis",
          selectTools: "Selecione as ferramentas"
        },
        devolucoes: {
          title: "Registrar Devolu√ß√£o",
          user: "Usu√°rio",
          tools: "Ferramentas pendentes",
          date: "Data",
          save: "Salvar",
          noData: "Nenhuma ferramenta pendente",
          pendingTools: "Ferramentas pendentes",
          selectTools: "Selecione as ferramentas para devolver"
        },
        relatorios: {
          title: "Relat√≥rios",
          pendingTools: "Ferramentas Pendentes",
          pendingUsers: "Usu√°rios Pendentes",
          noPendingTools: "Nenhuma ferramenta pendente",
          noPendingUsers: "Nenhum usu√°rio pendente",
          user: "Usu√°rio",
          tools: "Ferramentas",
          loanDate: "Data Empr√©stimo",
          pendingCount: "Qtd Pendente"
        },
        config: {
          save: "Salvar Configura√ß√£o",
          saved: "Configura√ß√µes salvas!",
          required: "Token e reposit√≥rio s√£o obrigat√≥rios!"
        },
        sync: {
          sync: "Sincronizar",
          load: "Carregar Dados",
          syncing: "Sincronizando...",
          success: "Sincronizado com sucesso!",
          error: "Erro na sincroniza√ß√£o:",
          loading: "Carregando dados...",
          loaded: "Dados carregados do GitHub!",
          notFound: "Arquivo data.json n√£o encontrado!",
          configFirst: "Configure o GitHub primeiro!"
        }
      },
      es: {
        title: "Sistema de Control de Herramientas",
        theme: "üåì Tema",
        language: "üåê Idioma",
        sections: {
          funcionarios: "Empleados",
          ferramentas: "Herramientas",
          emprestimos: "Pr√©stamos",
          devolucoes: "Devoluciones",
          relatorios: "Informes"
        },
        funcionarios: {
          title: "Registro de Empleados",
          placeholder: "Nombre del empleado",
          save: "Guardar",
          actions: "Acciones",
          edit: "Editar",
          delete: "Eliminar",
          noData: "No hay empleados registrados"
        },
        ferramentas: {
          title: "Registro de Herramientas",
          namePlaceholder: "Nombre de la herramienta",
          obsPlaceholder: "Observaciones",
          qtdPlaceholder: "Cantidad",
          save: "Guardar",
          number: "N√∫mero",
          observations: "Observaciones",
          actions: "Acciones",
          edit: "Editar",
          delete: "Eliminar",
          noData: "No hay herramientas registradas"
        },
        emprestimos: {
          title: "Registrar Pr√©stamo",
          user: "Usuario",
          searchUser: "Buscar usuario...",
          tools: "Herramientas",
          date: "Fecha",
          save: "Guardar",
          noData: "No hay pr√©stamos registrados",
          availableTools: "Herramientas disponibles",
          selectTools: "Seleccione las herramientas"
        },
        devolucoes: {
          title: "Registrar Devoluci√≥n",
          user: "Usuario",
          tools: "Herramientas pendientes",
          date: "Fecha",
          save: "Guardar",
          noData: "No hay herramientas pendientes",
          pendingTools: "Herramientas pendientes",
          selectTools: "Seleccione las herramientas para devolver"
        },
        relatorios: {
          title: "Informes",
          pendingTools: "Herramientas Pendientes",
          pendingUsers: "Usuarios Pendientes",
          noPendingTools: "No hay herramientas pendientes",
          noPendingUsers: "No hay usuarios pendientes",
          user: "Usuario",
          tools: "Herramientas",
          loanDate: "Fecha Pr√©stamo",
          pendingCount: "Cant Pendiente"
        },
        config: {
          save: "Guardar Configuraci√≥n",
          saved: "¬°Configuraciones guardadas!",
          required: "¬°Token y repositorio son obligatorios!"
        },
        sync: {
          sync: "Sincronizar",
          load: "Cargar Datos",
          syncing: "Sincronizando...",
          success: "¬°Sincronizado correctamente!",
          error: "Error en sincronizaci√≥n:",
          loading: "Cargando datos...",
          loaded: "¬°Datos cargados de GitHub!",
          notFound: "¬°Archivo data.json no encontrado!",
          configFirst: "¬°Configura GitHub primero!"
        }
      }
    };

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', () => {
      carregarDados();
      aplicarTema();
      atualizarIdioma();
      loadGithubConfig();
      mostrarSecao('funcionarios');
    });

    // Carregar dados do localStorage
    function carregarDados() {
      const dadosFuncionarios = localStorage.getItem('funcionarios');
      const dadosFerramentas = localStorage.getItem('ferramentas');
      const dadosEmprestimos = localStorage.getItem('emprestimos');
      const dadosContador = localStorage.getItem('contadorFerramentas');
      const dadosTema = localStorage.getItem('darkMode');
      const dadosIdioma = localStorage.getItem('portuguese');

      if (dadosFuncionarios) funcionarios = JSON.parse(dadosFuncionarios);
      if (dadosFerramentas) ferramentas = JSON.parse(dadosFerramentas);
      if (dadosEmprestimos) emprestimos = JSON.parse(dadosEmprestimos);
      if (dadosContador) contadorFerramentas = JSON.parse(dadosContador);
      if (dadosTema) darkMode = dadosTema === 'true';
      if (dadosIdioma) portuguese = dadosIdioma === 'true';
      
      if (darkMode) document.body.classList.add('dark-mode');
    }

    // Salvar dados no localStorage
    function salvarDados() {
      localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
      localStorage.setItem('ferramentas', JSON.stringify(ferramentas));
      localStorage.setItem('emprestimos', JSON.stringify(emprestimos));
      localStorage.setItem('contadorFerramentas', JSON.stringify(contadorFerramentas));
      localStorage.setItem('darkMode', darkMode);
      localStorage.setItem('portuguese', portuguese);
    }

    // Alternar tema
    function toggleTheme() {
      darkMode = !darkMode;
      document.body.classList.toggle('dark-mode', darkMode);
      salvarDados();
    }

    function aplicarTema() {
      if (darkMode) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }

    // Alternar idioma
    function toggleLanguage() {
      portuguese = !portuguese;
      atualizarIdioma();
      salvarDados();
      const secaoAtual = conteudoEl.getAttribute('data-section') || 'funcionarios';
      mostrarSecao(secaoAtual);
    }

    function atualizarIdioma() {
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang];
      
      document.getElementById('main-title').textContent = t.title;
      document.querySelector('.theme-toggle').textContent = t.theme;
      document.querySelector('.language-toggle').textContent = t.language;
      document.querySelector('.sync-button[onclick="syncData()"]').textContent = `üîÑ ${t.sync.sync}`;
      document.querySelector('.sync-button[onclick="loadFromGitHub()"]').textContent = `‚¨áÔ∏è ${t.sync.load}`;
      document.querySelector('.config-button').textContent = t.config.save;
      document.getElementById('githubToken').placeholder = portuguese ? 'Token do GitHub' : 'Token de GitHub';
      document.getElementById('repoName').placeholder = portuguese ? 'usuario/repositorio' : 'usuario/repositorio';
      
      // Atualizar bot√µes de navega√ß√£o
      for (const [key, value] of Object.entries(t.sections)) {
        const btn = document.getElementById(`btn-${key}`);
        if (btn) btn.textContent = value;
      }
    }

    // Mostrar se√ß√£o
    function mostrarSecao(secao) {
      const hoje = new Date().toISOString().split('T')[0];
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang];

      conteudoEl.setAttribute('data-section', secao);

      if (secao === 'funcionarios') {
        conteudoEl.innerHTML = `
          <h2>${t.funcionarios.title}</h2>
          <form onsubmit="event.preventDefault(); salvarFuncionario()">
            <input type="text" id="nomeFuncionario" placeholder="${t.funcionarios.placeholder}" required>
            <button type="submit" class="action-button">${t.funcionarios.save}</button>
          </form>
          <table>
            <thead>
              <tr>
                <th>${t.funcionarios.placeholder}</th>
                <th>${t.funcionarios.actions}</th>
              </tr>
            </thead>
            <tbody>
              ${funcionarios.length > 0 ? 
                funcionarios.sort((a, b) => a.localeCompare(b)).map((f, i) => `
                  <tr>
                    <td>${f}</td>
                    <td>
                      <button class="action-button" onclick="editarFuncionario(${i})">${t.funcionarios.edit}</button>
                      <button class="action-button delete-button" onclick="excluirFuncionario(${i})">${t.funcionarios.delete}</button>
                    </td>
                  </tr>
                `).join('') : `
                <tr>
                  <td colspan="2">${t.funcionarios.noData}</td>
                </tr>
              `}
            </tbody>
          </table>
        `;
      }
      else if (secao === 'ferramentas') {
        conteudoEl.innerHTML = `
          <h2>${t.ferramentas.title}</h2>
          <form onsubmit="event.preventDefault(); salvarFerramenta()">
            <div class="form-row">
              <div class="form-group">
                <input type="text" id="nomeFerramenta" placeholder="${t.ferramentas.namePlaceholder}" required>
              </div>
              <div class="form-group">
                <input type="text" id="obsFerramenta" placeholder="${t.ferramentas.obsPlaceholder}">
              </div>
              <div class="form-group">
                <input type="number" id="qtdFerramenta" placeholder="${t.ferramentas.qtdPlaceholder}" min="1" value="1">
              </div>
            </div>
            <button type="submit" class="action-button">${t.ferramentas.save}</button>
          </form>
          <table>
            <thead>
              <tr>
                <th>${t.ferramentas.namePlaceholder}</th>
                <th>${t.ferramentas.number}</th>
                <th>${t.ferramentas.observations}</th>
                <th>${t.ferramentas.actions}</th>
              </tr>
            </thead>
            <tbody>
              ${ferramentas.length > 0 ? 
                ferramentas.sort((a, b) => a.nome.localeCompare(b.nome)).map((f, i) => `
                  <tr>
                    <td>${f.nome}</td>
                    <td>${f.numero}</td>
                    <td>${f.obs || '-'}</td>
                    <td>
                      <button class="action-button" onclick="editarFerramenta(${i})">${t.ferramentas.edit}</button>
                      <button class="action-button delete-button" onclick="excluirFerramenta(${i})">${t.ferramentas.delete}</button>
                    </td>
                  </tr>
                `).join('') : `
                <tr>
                  <td colspan="4">${t.ferramentas.noData}</td>
                </tr>
              `}
            </tbody>
          </table>
        `;
      }
      else if (secao === 'emprestimos') {
        const usuarios = [...funcionarios].sort((a, b) => a.localeCompare(b));
        const disponiveis = ferramentas
          .filter(f => !emprestimos.some(e => 
            (Array.isArray(e.ferramenta) ? 
              e.ferramenta.includes(`${f.nome} - ${f.numero}`) : 
              e.ferramenta === `${f.nome} - ${f.numero}`) && 
            !e.devolvido
          ))
          .sort((a, b) => a.nome.localeCompare(b.nome));

        conteudoEl.innerHTML = `
          <h2>${t.emprestimos.title}</h2>
          <form onsubmit="event.preventDefault(); salvarEmprestimo()">
            <div class="form-row">
              <div class="form-group">
                <label>${t.emprestimos.user}</label>
                <select id="usuarioEmprestimo" required>
                  ${usuarios.map(u => `<option>${u}</option>`).join('')}
                </select>
              </div>
              <div class="form-group">
                <label>${t.emprestimos.tools}</label>
                <select id="ferramentaEmprestimo" multiple class="multi-select" required>
                  ${disponiveis.map(f => `<option value="${f.nome} - ${f.numero}">${f.nome} - ${f.numero}</option>`).join('')}
                </select>
                <small>${t.emprestimos.selectTools} (Ctrl+Clique para m√∫ltiplas sele√ß√µes)</small>
              </div>
              <div class="form-group">
                <label>${t.emprestimos.date}</label>
                <input type="date" id="dataEmprestimo" value="${hoje}" required>
              </div>
            </div>
            <button type="submit" class="action-button">${t.emprestimos.save}</button>
          </form>
          <table>
            <thead>
              <tr>
                <th>${t.emprestimos.user}</th>
                <th>${t.emprestimos.tools}</th>
                <th>${t.emprestimos.date}</th>
              </tr>
            </thead>
            <tbody>
              ${emprestimos.length > 0 ? 
                emprestimos.map(e => `
                  <tr>
                    <td>${e.usuario}</td>
                    <td>${Array.isArray(e.ferramenta) ? e.ferramenta.join(', ') : e.ferramenta}</td>
                    <td>${e.data}</td>
                  </tr>
                `).join('') : `
                <tr>
                  <td colspan="3">${t.emprestimos.noData}</td>
                </tr>
              `}
            </tbody>
          </table>
        `;
      }
      else if (secao === 'devolucoes') {
        const usuariosPendentes = [...new Set(emprestimos
          .filter(e => !e.devolvido)
          .map(e => e.usuario))].sort((a, b) => a.localeCompare(b));

        conteudoEl.innerHTML = `
          <h2>${t.devolucoes.title}</h2>
          <form onsubmit="event.preventDefault(); salvarDevolucao()">
            <div class="form-row">
              <div class="form-group">
                <label>${t.devolucoes.user}</label>
                <select id="usuarioDevolucao" onchange="carregarFerramentasPendentes()" required>
                  ${usuariosPendentes.length > 0 ? 
                    usuariosPendentes.map(u => `<option>${u}</option>`).join('') : 
                    `<option disabled selected>${t.devolucoes.noData}</option>`}
                </select>
              </div>
              <div class="form-group">
                <label>${t.devolucoes.tools}</label>
                <select id="ferramentaDevolucao" multiple class="multi-select" ${usuariosPendentes.length === 0 ? 'disabled' : ''} required>
                </select>
                <small>${t.devolucoes.selectTools} (Ctrl+Clique para m√∫ltiplas sele√ß√µes)</small>
              </div>
              <div class="form-group">
                <label>${t.devolucoes.date}</label>
                <input type="date" id="dataDevolucao" value="${hoje}" required>
              </div>
            </div>
            <button type="submit" class="action-button" ${usuariosPendentes.length === 0 ? 'disabled' : ''}>${t.devolucoes.save}</button>
          </form>
          <h3>${t.devolucoes.pendingTools}</h3>
          <table>
            <thead>
              <tr>
                <th>${t.devolucoes.user}</th>
                <th>${t.devolucoes.tools}</th>
                <th>${t.emprestimos.date}</th>
              </tr>
            </thead>
            <tbody>
              ${emprestimos.filter(e => !e.devolvido).length > 0 ? 
                emprestimos.filter(e => !e.devolvido).map(e => `
                  <tr>
                    <td>${e.usuario}</td>
                    <td>${Array.isArray(e.ferramenta) ? e.ferramenta.join(', ') : e.ferramenta}</td>
                    <td>${e.data}</td>
                  </tr>
                `).join('') : `
                <tr>
                  <td colspan="3">${t.devolucoes.noData}</td>
                </tr>
              `}
            </tbody>
          </table>
        `;

        if (usuariosPendentes.length > 0) {
          carregarFerramentasPendentes();
        }
      }
      else if (secao === 'relatorios') {
        const pendentes = emprestimos.filter(e => !e.devolvido);
        const usuariosPendentes = [...new Set(pendentes.map(e => e.usuario))].sort((a, b) => a.localeCompare(b));
        
        // Contar ferramentas pendentes por usu√°rio
        const ferramentasPorUsuario = {};
        pendentes.forEach(e => {
          if (!ferramentasPorUsuario[e.usuario]) {
            ferramentasPorUsuario[e.usuario] = {
              count: 0,
              ferramentas: []
            };
          }
          
          if (Array.isArray(e.ferramenta)) {
            ferramentasPorUsuario[e.usuario].count += e.ferramenta.length;
            ferramentasPorUsuario[e.usuario].ferramentas.push(...e.ferramenta.map(f => ({
              nome: f,
              data: e.data
            })));
          } else {
            ferramentasPorUsuario[e.usuario].count += 1;
            ferramentasPorUsuario[e.usuario].ferramentas.push({
              nome: e.ferramenta,
              data: e.data
            });
          }
        });
        
        conteudoEl.innerHTML = `
          <h2>${t.relatorios.title}</h2>
          
          <div class="report-section">
            <h3>${t.relatorios.pendingTools}</h3>
            ${pendentes.length > 0 ? `
              <table>
                <thead>
                  <tr>
                    <th>${t.relatorios.user}</th>
                    <th>${t.relatorios.tools}</th>
                    <th>${t.relatorios.loanDate}</th>
                  </tr>
                </thead>
                <tbody>
                  ${pendentes.flatMap(e => {
                    if (Array.isArray(e.ferramenta)) {
                      return e.ferramenta.map(f => `
                        <tr>
                          <td>${e.usuario}</td>
                          <td>${f}</td>
                          <td>${e.data}</td>
                        </tr>
                      `);
                    } else {
                      return `
                        <tr>
                          <td>${e.usuario}</td>
                          <td>${e.ferramenta}</td>
                          <td>${e.data}</td>
                        </tr>
                      `;
                    }
                  }).join('')}
                </tbody>
              </table>
            ` : `<p>${t.relatorios.noPendingTools}</p>`}
          </div>
          
          <div class="report-section">
            <h3>${t.relatorios.pendingUsers}</h3>
            ${usuariosPendentes.length > 0 ? `
              <table>
                <thead>
                  <tr>
                    <th>${t.relatorios.user}</th>
                    <th>${t.relatorios.tools}</th>
                    <th>${t.relatorios.pendingCount}</th>
                  </tr>
                </thead>
                <tbody>
                  ${usuariosPendentes.map(u => {
                    const info = ferramentasPorUsuario[u];
                    const ferramentasList = info.ferramentas.map(f => `${f.nome} (${f.data})`).join(', ');
                    return `
                      <tr>
                        <td>${u}</td>
                        <td>${ferramentasList}</td>
                        <td>${info.count}</td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            ` : `<p>${t.relatorios.noPendingUsers}</p>`}
          </div>
        `;
      }
    }

    // Fun√ß√µes para funcion√°rios
    function salvarFuncionario() {
      const nome = document.getElementById('nomeFuncionario').value.trim();
      if (nome && !funcionarios.includes(nome)) {
        funcionarios.push(nome);
        salvarDados();
        mostrarSecao('funcionarios');
      } else if (funcionarios.includes(nome)) {
        alert(portuguese ? 'Funcion√°rio j√° existe!' : '¬°Empleado ya existe!');
      }
    }

    function editarFuncionario(index) {
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang].funcionarios;
      const novoNome = prompt(t.edit, funcionarios[index]);
      
      if (novoNome && novoNome.trim() && novoNome !== funcionarios[index]) {
        if (funcionarios.includes(novoNome)) {
          alert(portuguese ? 'Nome j√° existe!' : '¬°Nombre ya existe!');
          return;
        }
        
        // Atualizar empr√©stimos com o novo nome
        emprestimos.forEach(e => {
          if (e.usuario === funcionarios[index]) {
            e.usuario = novoNome;
          }
        });
        
        funcionarios[index] = novoNome;
        salvarDados();
        mostrarSecao('funcionarios');
      }
    }

    function excluirFuncionario(index) {
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang].funcionarios;
      const nome = funcionarios[index];
      
      if (confirm(`${t.delete} "${nome}"?`)) {
        if (emprestimos.some(e => e.usuario === nome && !e.devolvido)) {
          alert(portuguese ? 'N√£o pode excluir: tem ferramentas pendentes!' : '¬°No se puede eliminar: tiene herramientas pendientes!');
          return;
        }
        funcionarios.splice(index, 1);
        salvarDados();
        mostrarSecao('funcionarios');
      }
    }

    // Fun√ß√µes para ferramentas
    function salvarFerramenta() {
      const nome = document.getElementById('nomeFerramenta').value.trim();
      const obs = document.getElementById('obsFerramenta').value.trim();
      const qtd = parseInt(document.getElementById('qtdFerramenta').value) || 1;
      
      if (!nome) {
                alert(portuguese ? 'Nome da ferramenta √© obrigat√≥rio!' : '¬°Nombre de la herramienta es obligatorio!');
        return;
      }
      
      if (!contadorFerramentas[nome]) {
        contadorFerramentas[nome] = 0;
      }
      
      for (let i = 0; i < qtd; i++) {
        contadorFerramentas[nome]++;
        ferramentas.push({
          nome,
          numero: contadorFerramentas[nome],
          obs: obs || null
        });
      }
      
      salvarDados();
      mostrarSecao('ferramentas');
    }

    function editarFerramenta(index) {
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang].ferramentas;
      const ferramenta = ferramentas[index];
      
      const novoNome = prompt(`${t.edit} - Nome:`, ferramenta.nome);
      if (!novoNome || novoNome.trim() === '') return;
      
      const novaObs = prompt(`${t.edit} - Observa√ß√µes:`, ferramenta.obs || '');
      
      // Verifica se est√° emprestada
      const emprestada = emprestimos.some(e => 
        (Array.isArray(e.ferramenta) ? 
          e.ferramenta.includes(`${ferramenta.nome} - ${ferramenta.numero}`) : 
          e.ferramenta === `${ferramenta.nome} - ${ferramenta.numero}`) && 
        !e.devolvido
      );
      
      if (emprestada) {
        alert(portuguese ? 'N√£o pode editar: ferramenta emprestada!' : '¬°No se puede editar: herramienta prestada!');
        return;
      }
      
      ferramenta.nome = novoNome.trim();
      ferramenta.obs = novaObs ? novaObs.trim() : null;
      salvarDados();
      mostrarSecao('ferramentas');
    }

    function excluirFerramenta(index) {
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang].ferramentas;
      const ferramenta = ferramentas[index];
      
      if (!confirm(`${t.delete} "${ferramenta.nome} - ${ferramenta.numero}"?`)) {
        return;
      }
      
      // Verifica se est√° emprestada
      const emprestada = emprestimos.some(e => 
        (Array.isArray(e.ferramenta) ? 
          e.ferramenta.includes(`${ferramenta.nome} - ${ferramenta.numero}`) : 
          e.ferramenta === `${ferramenta.nome} - ${ferramenta.numero}`) && 
        !e.devolvido
      );
      
      if (emprestada) {
        alert(portuguese ? 'N√£o pode excluir: ferramenta emprestada!' : '¬°No se puede eliminar: herramienta prestada!');
        return;
      }
      
      ferramentas.splice(index, 1);
      salvarDados();
      mostrarSecao('ferramentas');
    }

    // Fun√ß√µes para empr√©stimos
    function salvarEmprestimo() {
      const usuario = document.getElementById('usuarioEmprestimo').value;
      const ferramentaSelect = document.getElementById('ferramentaEmprestimo');
      const data = document.getElementById('dataEmprestimo').value;
      
      // Obter ferramentas selecionadas
      const ferramentasSelecionadas = Array.from(ferramentaSelect.selectedOptions).map(opt => opt.value);
      
      if (ferramentasSelecionadas.length === 0) {
        alert(portuguese ? 'Selecione pelo menos uma ferramenta!' : '¬°Seleccione al menos una herramienta!');
        return;
      }
      
      // Criar um empr√©stimo para cada ferramenta ou um √∫nico com array
      if (ferramentasSelecionadas.length > 1) {
        emprestimos.push({
          usuario,
          ferramenta: ferramentasSelecionadas,
          data,
          devolvido: false
        });
      } else {
        emprestimos.push({
          usuario,
          ferramenta: ferramentasSelecionadas[0],
          data,
          devolvido: false
        });
      }
      
      salvarDados();
      mostrarSecao('emprestimos');
    }

    // Fun√ß√µes para devolu√ß√µes
    function carregarFerramentasPendentes() {
      const usuario = document.getElementById('usuarioDevolucao').value;
      const select = document.getElementById('ferramentaDevolucao');
      
      const pendentes = emprestimos.filter(e => 
        e.usuario === usuario && !e.devolvido
      );
      
      // Criar array com todas as ferramentas pendentes
      const todasFerramentas = pendentes.flatMap(e => 
        Array.isArray(e.ferramenta) ? 
          e.ferramenta.map(f => ({ nome: f, data: e.data })) : 
          [{ nome: e.ferramenta, data: e.data }]
      );
      
      select.innerHTML = todasFerramentas.map(f => 
        `<option value="${f.nome}">${f.nome} (${f.data})</option>`
      ).join('');
    }

    function salvarDevolucao() {
      const usuario = document.getElementById('usuarioDevolucao').value;
      const ferramentaSelect = document.getElementById('ferramentaDevolucao');
      const dataDevolucao = document.getElementById('dataDevolucao').value;
      
      // Obter ferramentas selecionadas
      const ferramentasSelecionadas = Array.from(ferramentaSelect.selectedOptions).map(opt => opt.value);
      
      if (ferramentasSelecionadas.length === 0) {
        alert(portuguese ? 'Selecione pelo menos uma ferramenta!' : '¬°Seleccione al menos una herramienta!');
        return;
      }
      
      // Marcar como devolvido cada empr√©stimo correspondente
      ferramentasSelecionadas.forEach(fNome => {
        const emprestimo = emprestimos.find(e => 
          e.usuario === usuario && 
          ((Array.isArray(e.ferramenta) && e.ferramenta.includes(fNome)) || 
           (!Array.isArray(e.ferramenta) && e.ferramenta === fNome)) && 
          !e.devolvido
        );
        
        if (emprestimo) {
          emprestimo.devolvido = true;
          emprestimo.dataDevolucao = dataDevolucao;
        }
      });
      
      salvarDados();
      mostrarSecao('devolucoes');
    }

    // ============== FUN√á√ïES GITHUB ============== //
    function loadGithubConfig() {
      githubToken = localStorage.getItem('githubToken') || '';
      repoName = localStorage.getItem('repoName') || '';
      document.getElementById('githubToken').value = githubToken;
      document.getElementById('repoName').value = repoName;
    }

    function saveGithubConfig() {
      githubToken = document.getElementById('githubToken').value.trim();
      repoName = document.getElementById('repoName').value.trim();
      
      if (!githubToken || !repoName) {
        showSyncStatus(translations[portuguese ? 'pt' : 'es'].config.required, 'error');
        return;
      }
      
      localStorage.setItem('githubToken', githubToken);
      localStorage.setItem('repoName', repoName);
      showSyncStatus(translations[portuguese ? 'pt' : 'es'].config.saved, 'success');
    }

    function showSyncStatus(message, type = 'info') {
      syncStatusEl.textContent = message;
      syncStatusEl.className = `sync-status ${type}`;
      setTimeout(() => {
        syncStatusEl.className = 'sync-status';
        syncStatusEl.textContent = '';
      }, 5000);
    }

    async function syncData() {
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang].sync;
      
      if (!githubToken || !repoName) {
        showSyncStatus(t.configFirst, 'error');
        return;
      }

      try {
        showSyncStatus(t.syncing, 'info');
        
        // Criar payload
        const data = {
          funcionarios,
          ferramentas,
          emprestimos,
          contadorFerramentas
        };
        
        // Verificar se o arquivo existe
        const existingFile = await checkFileExists();
        let sha = existingFile ? existingFile.sha : null;
        
        // Fazer upload
        const url = `https://api.github.com/repos/${repoName}/contents/data.json`;
        const response = await fetch(url, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${githubToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'Atualiza√ß√£o autom√°tica do sistema de ferramentas',
            content: btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2)))),
            sha: sha
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || t.error);
        }
        
        showSyncStatus(t.success, 'success');
      } catch (error) {
        console.error('Erro na sincroniza√ß√£o:', error);
        showSyncStatus(`${t.error} ${error.message}`, 'error');
      }
    }

    async function checkFileExists() {
      try {
        const url = `https://api.github.com/repos/${repoName}/contents/data.json`;
        const response = await fetch(url, {
          headers: {
            'Authorization': `token ${githubToken}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (response.status === 404) return null;
        if (!response.ok) throw new Error(portuguese ? 'Erro ao verificar arquivo' : 'Error al verificar archivo');
        
        return await response.json();
      } catch (error) {
        throw error;
      }
    }

    async function loadFromGitHub() {
      const lang = portuguese ? 'pt' : 'es';
      const t = translations[lang].sync;
      
      try {
        showSyncStatus(t.loading, 'info');
        
        if (!githubToken || !repoName) {
          showSyncStatus(t.configFirst, 'error');
          return;
        }
        
        const existingFile = await checkFileExists();
        if (!existingFile) {
          showSyncStatus(t.notFound, 'warning');
          return;
        }
        
        const response = await fetch(existingFile.download_url);
        if (!response.ok) throw new Error(portuguese ? 'Erro ao baixar arquivo' : 'Error al descargar archivo');
        
        const remoteData = await response.json();
        
        // Atualizar dados locais
        funcionarios = remoteData.funcionarios || [];
        ferramentas = remoteData.ferramentas || [];
        emprestimos = remoteData.emprestimos || [];
        contadorFerramentas = remoteData.contadorFerramentas || {};
        
        salvarDados();
        mostrarSecao('funcionarios');
        showSyncStatus(t.loaded, 'success');
      } catch (error) {
        showSyncStatus(`${t.error} ${error.message}`, 'error');
      }
    }
  </script>
</body>
</html>